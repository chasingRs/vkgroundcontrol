# For develop

## 缺水返航函数调用流程

1. 剩余水量和低液位的检测
   通过定时器轮询判断当前的总耗水量，结合用户设置的出水罐的体积，得到剩余水量;

2. 当水量小于 1L 时触发缺水返航，此时通过任务系统这个接口:

```js
//----------------------- 任务系统 -----------------------
/**
 * @class Vk_MissionCurrent
 * @brief 当前任务点消息
 * @details 负责监控和管理无人机任务执行过程中的实时状态信息，包括航点进度、
 *          执行状态、任务模式以及相关计划的标识信息。提供完整的任务状态跟踪
 *          和状态变化通知功能，支持任务规划系统的实时监控需求。
 *          飞控定期下传, 默认 1hz. 包含当前任务航点序号等信息. 注意 seq 字段从 0 开始
 */
class Vk_MissionCurrent : public QObject {
    Q_OBJECT

    /**
     * @brief 当前执行航点序号
     * @details 表示任务中当前正在执行或即将执行的航点编号，从0开始计数。
     *          该值随任务进度实时更新，用于跟踪任务执行的具体位置。
     */
    Q_PROPERTY(quint16 missionCurrentSeq READ missionCurrentSeq NOTIFY statusUpdated)
    // ......
};
```

获取并保存当前的正在执行清洗工作的航点的序号(也即在此处被中断的航点)

3. 用户点击`返航加水`后调用

```js
activeVehicle.returnMission(NaN, 0); // 直线返航到Home点
```

执行返航(TODO：确认在调用`startMission()`函数并且未执行完毕时，是否可以使用`returnMission()`函数进行打断直接执行返航)

4. 用户加水完毕后，点击 `返回工作点` 后再次执行 `startMission()`函数，但是任务的起始序号被设置为之前保存的中断的航点的序号,

预期目标： UAV 将之前中断的航点当成新的任务起点，飞回到此处继续工作(???)

5. 调试模式 ： 设置值为`true`开启调试模式

```js
    // ================== 调试模式控制 ==================
    // 设置为 false 可以完全禁用所有调试功能
    readonly property bool debugModeEnabled: false
```

# For User

## 返航缺水功能使用说明

1. 进入清洗界面，设置水箱的总容量
2. 缺水时，提示缺水，是否自动返航 选择 `确认返航`， 界面提示正在返航
3. 返回到起飞点后，飞机保持悬停(?), 用户切换到手动模式进行降落并加水
4. 加水完毕后，点击`返回工作点`, 继续飞回到返航之前的工作点继续执行任务, 然后用户可以点击`完成`按钮关闭所有对话
